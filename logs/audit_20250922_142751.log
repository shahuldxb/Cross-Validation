2025-09-22 14:27:51,712 - INFO - setup_audit_logging:77 - === AUDIT LOG STARTED ===
2025-09-22 14:27:51,713 - INFO - setup_audit_logging:78 - Log file: logs\audit_20250922_142751.log
2025-09-22 14:27:51,713 - INFO - main:489 - === STARTING MAIN APPLICATION ===
2025-09-22 14:27:51,713 - INFO - create_directories:112 - Creating required directories
2025-09-22 14:27:51,714 - INFO - create_directories:118 - Directories created successfully: input/, output/
2025-09-22 14:27:51,714 - INFO - validate_azure_config:84 - Starting Azure OpenAI configuration validation
2025-09-22 14:27:51,714 - INFO - validate_azure_config:100 - Environment variable AZURE_OPENAI_ENDPOINT: SET
2025-09-22 14:27:51,715 - INFO - validate_azure_config:100 - Environment variable AZURE_OPENAI_API_KEY: SET
2025-09-22 14:27:51,716 - INFO - validate_azure_config:100 - Environment variable AZURE_OPENAI_API_VERSION: SET
2025-09-22 14:27:51,716 - INFO - validate_azure_config:100 - Environment variable AZURE_OPENAI_CHAT_DEPLOYMENT: SET
2025-09-22 14:27:51,716 - INFO - validate_azure_config:107 - Azure OpenAI configuration validation completed successfully
2025-09-22 14:27:51,717 - INFO - main:500 - Application initialization completed
2025-09-22 14:27:51,739 - INFO - split_secondary_documents:174 - Starting AI-based secondary document splitting
2025-09-22 14:27:51,739 - DEBUG - split_secondary_documents:180 - Secondary content size: 2763 characters
2025-09-22 14:27:51,739 - INFO - split_secondary_documents:271 - Sending content to Azure OpenAI for document splitting
2025-09-22 14:28:03,561 - DEBUG - split_secondary_documents:292 - AI response: ```json
[
  {
    "heading": "COMMERCIAL INVOICE",
    "content": "Seller: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nInvoice No.: INV-2025-1025\nDate of Invoice: 25 October 2025\nBuyer: Al Madina ...
2025-09-22 14:28:03,561 - ERROR - split_secondary_documents:299 - Failed to parse AI response as JSON: Expecting value: line 1 column 1 (char 0)
2025-09-22 14:28:03,561 - DEBUG - split_secondary_documents:300 - Raw response: ```json
[
  {
    "heading": "COMMERCIAL INVOICE",
    "content": "Seller: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nInvoice No.: INV-2025-1025\nDate of Invoice: 25 October 2025\nBuyer: Al Madina Electronics LLC, Dubai, UAE\nGoods Description: Rechargeable Lithium-Ion Batteries (Model LP-500)\nQuantity: 520 units\nUnit Price: USD 147.00\nTotal Amount: USD 76,440.00\nIncoterms: FOB Yantian Port, China (Incoterms® 2020)\nCountry of Origin: China\nPort of Loading: Yantian Port, China\nPort of Discharge: Port Khalifa, Abu Dhabi, UAE\nAuthorized Signature and Company Seal: Shenzhen PowerTech Co. Ltd.",
    "identified_name": "Commercial Invoice"
  },
  {
    "heading": "PACKING LIST",
    "content": "Exporter: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nPacking List No.: PL-2025-1031\nDate of Issue: 17 October 2025\nConsignee: Al Madinah Electronics LLC, Dubai, UAE\nGoods Description: Lithium-Ion Batteries (Model LP-500)\nQuantity: 500 units\nNumber of Packages: 52 cartons\nGross Weight: 1,040 kg\nNet Weight: 920 kg\nMarks & Numbers: PT-LION-2025\nPort of Loading: Yantian Port, China\nPort of Discharge: Port Khalifa, Abu Dhabi, UAE\nDate of Shipment: 18 October 2025\nPartial Shipment: Allowed\nAuthorized Signature and Company Seal: Shenzhen PowerTech Co. Ltd.",
    "identified_name": "Packing List"
  },
  {
    "heading": "CERTIFICATE OF ORIGIN",
    "content": "Issuing Authority: Shenzhen Chamber of Commerce\nCertificate No.: COO-2025-1129\nExporter: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nConsignee: Al Madinah Electronics LLC, Dubai, UAE\nGoods Description: Rechargeable Batteries for Consumer Devices (Nickel-Metal Hydride)\nHS Code: 8507.60\nQuantity: 480 units\nCountry of Origin: People’s Republic of China\nDate of Export: 20 October 2025\nPlace of Issue: Shenzhen, China\nAuthorized Stamp and Signature: Shenzhen Chamber of Commerce",
    "identified_name": "Certificate of Origin"
  },
  {
    "heading": "INSPECTION / QUALITY CERTIFICATE",
    "content": "Issued By: Shenzhen PowerTech Co. Ltd. – Quality Assurance Division\nCertificate No.: QC-2025-7782\nInspection Date: 21 October 2025\nExporter: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nConsignee: Al Madinah Electronics LLC, Dubai, UAE\nGoods: Rechargeable Lithium-Ion Batteries (Model LP-500)\nInspected Quantity: 480 units\nResult: Passed — Functional and Physical QC\nInspection Method: Random Sampling (AQL 1.0)\nPort of Loading: Yantian Port, China\nPort of Discharge: Port Khalifa, Abu Dhabi, UAE\nAuthorized Signature: QA Director, Shenzhen PowerTech",
    "identified_name": "Inspection / Quality Certificate"
  },
  {
    "heading": "DANGEROUS GOODS DECLARATION",
    "content": "Shipper: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nConsignee: Al Madinah Electronics LLC, Dubai, UAE\nVessel/Voyage No.: COSCO Vessel / Voyage 2025-42\nPort of Loading: Yantian Port, China\nPort of Discharge: Port Khalifa, Abu Dhabi, UAE\nDescription of Goods: LITHIUM METAL BATTERIES\nUN Number: UN 3090\nIMO Class: 9\nPacking Group: II\nNumber of Packages: 50 cartons\nNet Quantity of Dangerous Goods: 920 kg\nPacking Instruction: P903\nDeclaration Date: 20 October 2025\nSigned: Authorized DG Officer, Shenzhen PowerTech Co. Ltd.",
    "identified_name": "Dangerous Goods Declaration"
  }
]
```
2025-09-22 14:28:03,563 - INFO - clean_input_directory:122 - Cleaning input directory
2025-09-22 14:28:03,565 - DEBUG - clean_input_directory:132 - Deleted file: ilc.txt
2025-09-22 14:28:03,565 - INFO - clean_input_directory:138 - Cleaned input directory. Deleted 1 files: ['ilc.txt']
2025-09-22 14:28:03,565 - INFO - save_primary_document:142 - Saving primary document with code: ILC
2025-09-22 14:28:03,566 - INFO - save_primary_document:161 - Primary document saved successfully: input\ilc.txt
2025-09-22 14:28:03,567 - DEBUG - save_primary_document:162 - Primary document size: 732 characters
2025-09-22 14:28:03,567 - INFO - save_primary_document:163 - Added LC heading for cross_new_csv.py compatibility
2025-09-22 14:28:03,567 - INFO - save_primary_document:164 - Using lowercase filename ilc.txt for LC detection
2025-09-22 14:28:03,567 - INFO - split_secondary_documents:174 - Starting AI-based secondary document splitting
2025-09-22 14:28:03,567 - DEBUG - split_secondary_documents:180 - Secondary content size: 2763 characters
2025-09-22 14:28:03,567 - INFO - split_secondary_documents:271 - Sending content to Azure OpenAI for document splitting
2025-09-22 14:28:18,395 - DEBUG - split_secondary_documents:292 - AI response: [
    {
        "heading": "COMMERCIAL INVOICE",
        "content": "Seller: Shenzhen PowerTech Co. Ltd., Shenzhen, China\nInvoice No.: INV-2025-1025\nDate of Invoice: 25 October 2025\nBuyer: Al Madin...
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:297 - Successfully parsed JSON response with 5 documents
2025-09-22 14:28:18,396 - DEBUG - split_secondary_documents:308 - AI identified document: COMMERCIAL INVOICE -> Commercial Invoice
2025-09-22 14:28:18,396 - DEBUG - split_secondary_documents:308 - AI identified document: PACKING LIST -> Packing List
2025-09-22 14:28:18,396 - DEBUG - split_secondary_documents:308 - AI identified document: CERTIFICATE OF ORIGIN -> Certificate of Origin
2025-09-22 14:28:18,396 - DEBUG - split_secondary_documents:308 - AI identified document: INSPECTION / QUALITY CERTIFICATE -> Inspection / Quality Certificate
2025-09-22 14:28:18,396 - DEBUG - split_secondary_documents:308 - AI identified document: DANGEROUS GOODS DECLARATION -> Dangerous Goods Declaration
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:310 - AI-based document splitting completed. Found 5 documents
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:315 - Document 1: COMMERCIAL INVOICE (Commercial Invoice) - 527 chars
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:315 - Document 2: PACKING LIST (Packing List) - 557 chars
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:315 - Document 3: CERTIFICATE OF ORIGIN (Certificate of Origin) - 477 chars
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:315 - Document 4: INSPECTION / QUALITY CERTIFICATE (Inspection / Quality Certificate) - 550 chars
2025-09-22 14:28:18,396 - INFO - split_secondary_documents:315 - Document 5: DANGEROUS GOODS DECLARATION (Dangerous Goods Declaration) - 523 chars
2025-09-22 14:28:18,396 - INFO - save_secondary_documents:327 - Saving 5 secondary documents
2025-09-22 14:28:18,397 - INFO - save_secondary_documents:356 - Saved secondary document: COMMERCIAL INVOICE.txt (Commercial Invoice) with heading: Commercial Invoice (INV)
2025-09-22 14:28:18,397 - INFO - save_secondary_documents:356 - Saved secondary document: PACKING LIST.txt (Packing List) with heading: Packing List (PL)
2025-09-22 14:28:18,398 - INFO - save_secondary_documents:356 - Saved secondary document: CERTIFICATE OF ORIGIN.txt (Certificate of Origin) with heading: Insurance Certificate (INS)
2025-09-22 14:28:18,398 - ERROR - save_secondary_documents:360 - Error saving secondary document 4: [Errno 2] No such file or directory: 'input\\INSPECTION \\ QUALITY CERTIFICATE.txt'
2025-09-22 14:28:18,399 - INFO - save_secondary_documents:356 - Saved secondary document: DANGEROUS GOODS DECLARATION.txt (Dangerous Goods Declaration) with heading: Trade Document (Dangerous Goods Declaration)
2025-09-22 14:28:18,399 - INFO - save_secondary_documents:363 - Successfully saved 4 secondary documents
2025-09-22 14:28:18,403 - INFO - run_discrepancy_analysis:389 - Starting discrepancy analysis
2025-09-22 14:28:18,403 - INFO - run_discrepancy_analysis:394 - Checking for analysis script: cross_new_csv.py
2025-09-22 14:28:18,403 - INFO - run_discrepancy_analysis:402 - Analysis script found, preparing to execute
2025-09-22 14:28:18,404 - INFO - run_discrepancy_analysis:407 - Input files for analysis: ['CERTIFICATE OF ORIGIN.txt', 'COMMERCIAL INVOICE.txt', 'DANGEROUS GOODS DECLARATION.txt', 'ilc.txt', 'PACKING LIST.txt']
2025-09-22 14:28:18,404 - INFO - run_discrepancy_analysis:410 - Executing cross_new_csv.py script
2025-09-22 14:28:46,748 - INFO - run_discrepancy_analysis:418 - Script execution completed with return code: 0
2025-09-22 14:28:46,748 - INFO - run_discrepancy_analysis:421 - Script stdout: [*] Starting Trade Finance Compliance Analysis
==================================================
[OK] Folders ready: .\input and .\output
[OK] Found 5 .txt files:
  - CERTIFICATE OF ORIGIN.txt
  - COMMERCIAL INVOICE.txt
  - DANGEROUS GOODS DECLARATION.txt
  - ilc.txt
  - PACKING LIST.txt
[OK] LC document identified by filename: ilc.txt
[OK] Secondary documents: 4 files

[PROCESSING] Building analysis prompt...
[PROCESSING] Sending documents to Azure OpenAI for analysis...
[OK] Analysis completed successfully
[OK] Results saved to: .\output\compliance_analysis_ilc_20250922_142846.md
[OK] CSV exported: .\output\compliance_analysis_ilc_20250922_142846.csv

==================================================
[SUCCESS] Compliance Analysis Completed Successfully!
[REPORT] Report saved to: .\output\compliance_analysis_ilc_20250922_142846.md
[CSV] CSV exported alongside the report in the output folder.
[STATS] Base Document: ilc.txt
[FILES] Secondary Documents: 4 files analyzed

2025-09-22 14:28:46,749 - INFO - run_discrepancy_analysis:435 - Found analysis report: output\compliance_analysis_ilc_20250922_142846.md
2025-09-22 14:28:46,749 - INFO - run_discrepancy_analysis:439 - Found analysis CSV: output\compliance_analysis_ilc_20250922_142846.csv
2025-09-22 14:28:46,749 - INFO - run_discrepancy_analysis:446 - Discrepancy analysis completed successfully
2025-09-22 14:28:46,750 - INFO - display_file_content:458 - Displaying file content: output\compliance_analysis_ilc_20250922_142846.md (type: text)
2025-09-22 14:28:46,760 - INFO - display_file_content:477 - Successfully displayed text content (7305 characters)
2025-09-22 14:28:46,762 - INFO - display_file_content:458 - Displaying file content: output\compliance_analysis_ilc_20250922_142846.csv (type: csv)
2025-09-22 14:28:46,778 - INFO - display_file_content:464 - Successfully displayed CSV with 10 rows
